<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Videos</title>
    <!-- <link rel="stylesheet" href="videos.css" /> -->
  </head>
  <style>
    body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f9fbfd; /* light background */
  color: #222;
  margin: 0;
  padding: 20px;
}

/* HEADER */
.header {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  padding: 15px 20px;
  background: #ffffff; /* white header */
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  gap: 15px;
}

.header h1 {
  flex-basis: 100%;
  text-align: center;
  margin: 0 0 10px;
  font-size: 26px;
  color: #0056b3; /* Odyssey blue */
  font-weight: 600;
}

.header .header-controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 12px;
}

.header-controls p {
  margin: 0;
  font-weight: 500;
  color: #333;
}

.headerBtn {
  background-color: #007bff; /* Odyssey blue */
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 18px;
  font-size: 14px;
  transition: all 0.3s ease;
}
.headerBtn:hover {
  background-color: #0056b3; /* darker hover */
  cursor: pointer;
}

/* CHANNEL SUGGESTIONS */
#channelSuggestions {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  margin: 15px 0;
}

.channel-card {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #ffffff;
  padding: 8px 14px;
  border-radius: 10px;
  text-decoration: none;
  color: #0056b3;
  font-size: 14px;
  font-weight: 500;
  border: 1px solid #e0e6f0;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  transition: all 0.2s ease-in-out;
}
.channel-card img {
  width: 32px;
  height: 32px;
  border-radius: 50%;
}
.channel-card:hover {
  background: #f0f7ff;
  transform: translateY(-2px);
}

/* GRID CARDS */
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin-top: 20px;
}
.card {
  background: #ffffff;
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease;
}
.card:hover {
  transform: translateY(-4px);
}
.card h3 {
  font-size: 15px;
  margin: 10px 0;
  color: #333;
}
iframe {
  width: 100%;
  height: 200px;
  border-radius: 8px;
}

/* FAVORITES BTN */
.favBtn {
  background: #007bff;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  color: white;
  font-size: 13px;
}
.favBtn:hover {
  background: #0056b3;
}

/* Pagination container */
#pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  margin: 20px 0;
  flex-wrap: wrap;
}

/* Generic buttons */
#pagination .btn {
  min-width: 36px;
  height: 36px;
  background: #ffffff; /* white background */
  color: #0b5ed7; /* deep-blue text */
  border: 1px solid rgba(11, 94, 215, 0.12);
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease-in-out;
  box-shadow: none;
}

/* Hover */
#pagination .btn:hover {
  background: #e9f4ff; /* light blue hover */
  color: #0b5ed7;
  transform: translateY(-2px);
}

/* Active page */
#pagination .btn.active {
  background: #0b5ed7; /* active = blue */
  color: #ffffff; /* white text */
  box-shadow: 0 6px 12px rgba(11, 94, 215, 0.18);
  transform: translateY(-2px);
}

/* Prev/Next style (slightly larger) */
#pagination .prev,
#pagination .next {
  padding: 0 12px;
  border-radius: 6px;
  background: #f6fbff;
  color: #0b5ed7;
  border: 1px solid rgba(11, 94, 215, 0.08);
}

#pagination .prev:hover,
#pagination .next:hover {
  background: #0b63e4;
  color: #fff;
  transform: translateY(-2px);
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal-content {
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  width: 60%;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.modal-content h2 {
  color: #0056b3;
}

/* MODAL BUTTONS */
button.closeBtn {
  background: #ff4d4d;
  border: none;
  color: white;
  padding: 10px 18px;
  margin: 8px 5px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.3s;
}
button.closeBtn:hover {
  background: #e60000;
}
button.clearBtn {
  background: #007bff;
  border: none;
  color: white;
  padding: 10px 18px;
  margin: 8px 5px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.3s;
}
button.clearBtn:hover {
  background: #0056b3;
}

  </style>
  <body>
    <nav class="header">
      <h1>Video Gallery</h1>
      <div class="header-controls">
        <button class="headerBtn" onclick="showHistory()">Show History</button>
        <button class="headerBtn" onclick="showFavourites()">
          Show Favourites
        </button>
        <p>select courses :</p>

        <select
          id="categorySelect"
          onchange="changeCategory()"
          class="headerBtn">
          <option value="javascript">JavaScript</option>
          <option value="html">HTML</option>
          <option value="css">CSS</option>
          <option value="react js">React JS</option>
          <option value="sfmc">SFMC</option>
          <option value="sfcc">SFCC</option>
          <option value="salesforce">Salesforce</option>
        </select>
      </div>
    </nav>

    <!-- showing channels -->
    <div id="channelSuggestions" style="margin-left: 20px"></div>

    <div id="video-container" class="grid"></div>

    <div id="pagination" style="text-align: center; margin: 20px 0"></div>

    <!-- Popuping-->
    <div id="historyModal" class="modal">
      <div class="modal-content">
        <h2>History</h2>
        <p>Your watched videos will appear here.</p>
        <div id="historyList"></div>
        <button class="closeBtn" onclick="closeModal('historyModal')">
          Close
        </button>
        <button class="clearBtn" onclick="clearHistory()">Clear History</button>
      </div>
    </div>

    <div id="favouritesModal" class="modal">
      <div class="modal-content">
        <h2>Favourites</h2>
        <div id="favouritesList"></div>
        <button class="closeBtn" onclick="closeModal('favouritesModal')">
          Close
        </button>
        <button class="clearBtn" onclick="clearFavourites()">
          Clear Favourites
        </button>
      </div>
    </div>
    <script>
      let cachedPages = {}; // page -> list of videos

      const maxVideosPerLoad = 9;
      let category = "javascript";

      //let nextPageToken = ""; //for loading more vid
      let pageTokens = [""]; // pageTokens[0] is empty for the first page
      let currentPage = 0;


      const API_KEY = "AIzaSyAdbZki0nwZVRcjyRSosD6D8B-Kh3lPRU8";   //project 0 expired
      //const API_KEY = "AIzaSyBkX6_OJJvgRAvWN1oYYOU4dq9zueS8gF4";    //project 1
      //const API_KEY = "AIzaSyDTcv9gLihbaM4Wq5V1sYh6rbxTDX_aLUA";    //project 2

      async function fetchVideos(page = 0) {
        try {
          const container = document.getElementById("video-container");
          container.innerHTML = ""; // clear old results when switching pages

          // ✅ Check cache first
          if (cachedPages[page]) {
            console.log("Loaded from cache: Page", page);
            renderVideos(cachedPages[page]); // display cached videos
            currentPage = page;
            renderPagination();
            return; // stop here, no API call
          }

          let API_URL = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${category}+programming+tutorial&maxResults=${maxVideosPerLoad}&type=video&key=${API_KEY}`;

          //adding pageToken for vid, so unique vid r loade
          //if (nextPageToken) {
          // API_URL += `&pageToken=${nextPageToken}`;
          // }

          // Use stored pageToken if navigating
          if (pageTokens[page]) {
            API_URL += `&pageToken=${pageTokens[page]}`;
          }

          const res = await fetch(API_URL);
          const data = await res.json();
          console.log("YouTube API Response:", data);

          cachedPages[page] = data.items; // ✅ Save to cache
          renderVideos(data.items);

          //data.item.foreach loop is deleted

          // for each loop ended

          // Save nextPageToken if it exists
          if (data.nextPageToken && !pageTokens[page + 1]) {
            pageTokens[page + 1] = data.nextPageToken;
          }

          currentPage = page;
          renderPagination();

          //fetching more vid, store the value of pageToken
          //nextPageToken = data.nextPageToken || "";
        } catch (err) {
          console.error("Error fetching videos:", err);
        }
      }

      function renderVideos(videos) {
        const container = document.getElementById("video-container");
        container.innerHTML = "";

        videos.forEach((video) => {
          const videoId = video.id.videoId;
          const title = video.snippet.title;

          const card = document.createElement("div");
          card.classList.add("card");

          card.innerHTML = `
      <div class="video-container">
        <iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>
        <div class="video-overlay" onclick="saveToHistory('${videoId}', '${title.replace(
            /'/g,
            "\\'"
          )}',event)"></div>
      </div>
      <h3>${title}</h3>
      <button class="favBtn" onclick="addToFavourites('${videoId}', '${title.replace(
            /'/g,
            "\\'"
          )}')">Add to Favourites</button>
    `;

          container.appendChild(card);
        });
      }

      //render pages
      function renderPagination() {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        // Prev button
        if (currentPage > 0) {
          const prevBtn = document.createElement("button");
          prevBtn.innerText = "Prev";
          prevBtn.className = "btn prev";
          prevBtn.onclick = () => fetchVideos(currentPage - 1);
          pagination.appendChild(prevBtn);
        }

        // Numbered page buttons (show up to 5 pages ahead)
        for (let i = 0; i < pageTokens.length; i++) {
          if (i > currentPage + 5) break; // only show limited pages
          const pageBtn = document.createElement("button");
          pageBtn.innerText = i + 1;
          pageBtn.className = "btn";
          if (i === currentPage) {
            //pageBtn.style.background = "darkred"; // highlight active page
            pageBtn.classList.add("active"); // use class, not inline style
          }
          pageBtn.onclick = () => fetchVideos(i);
          pagination.appendChild(pageBtn);
        }

        // Next button
        if (pageTokens[currentPage + 1]) {
          const nextBtn = document.createElement("button");
          nextBtn.innerText = "Next";
          nextBtn.className = "btn next";
          nextBtn.onclick = () => fetchVideos(currentPage + 1);
          pagination.appendChild(nextBtn);
        }
      }

      //selecting channels & giving to fetch Channel to get channels list
      function changeCategory() {
        const select = document.getElementById("categorySelect");
        category = select.value;

        // reset cache and pagination when category changes
        cachedPages = {};
        pageTokens = [""];
        currentPage = 0;

        fetchVideos(0); // reload videos based on new category
        fetchChannels(category); // 🔥 fetch channel suggestions too
      }

      //fetching channels
      async function fetchChannels(query) {
        try {
          let API_URL = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}+programming&type=channel&maxResults=5&key=${API_KEY}`;

          const res = await fetch(API_URL);
          const data = await res.json();

          const container = document.getElementById("channelSuggestions");
          container.innerHTML =
            "<strong style='flex-basis:100%'>Suggested Channels:</strong>";

          if (!data.items || data.items.length === 0) {
            container.innerHTML += "<p>No channels found.</p>";
            return;
          }

          data.items.forEach((ch) => {
            const channelId = ch.snippet.channelId;
            const channelTitle = ch.snippet.title;
            const channelThumb =
              ch.snippet.thumbnails?.default?.url ||
              "https://via.placeholder.com/32";

            // Channel card
            const link = document.createElement("a");
            link.href = `https://www.youtube.com/channel/${channelId}`;
            link.target = "_blank";
            link.className = "channel-card";
            link.innerHTML = `
        <img src="${channelThumb}" alt="${channelTitle}" />
        <span>${channelTitle}</span>
      `;

            container.appendChild(link);
          });
        } catch (err) {
          console.error("Error fetching channels:", err);
        }
      }

      // Modal Functions
      //saving to local after overlay is removed
      function saveToHistory(videoId, title, event) {
        let history = JSON.parse(localStorage.getItem("history")) || [];

        if (!history.find((v) => v.id === videoId)) {
          history.unshift({
            id: videoId,
            title,
            time: new Date().toLocaleString(),
          });
          localStorage.setItem("history", JSON.stringify(history));
        }

        //when vid clicked on iframe histry saved, later vid is clickable.
        const overlay = event.target;
        overlay.style.display = "none"; //rem the overlay
      }

      function showHistory() {
        const modal = document.getElementById("historyModal");
        const modalContent = modal.querySelector(".modal-content");

        modalContent.innerHTML = `<h2>History</h2>
                                  <div id="historyList"></div>
                                  <button class="closeBtn" onclick="closeModal('historyModal')">Close</button>
                                  <button class="clearBtn" onclick="clearHistory()">Clear History</button>`;

        let history = JSON.parse(localStorage.getItem("history")) || [];
        const list = modalContent.querySelector("#historyList");

        if (history.length === 0) {
          list.innerHTML = "<p>No videos watched yet.</p>";
        } else {
          history.forEach((video) => {
            const div = document.createElement("div");
            div.innerHTML = `
        <h4>${video.title}</h4>
        <p><small>Watched on: ${video.time}</small></p>
        <iframe width="100%" height="200" src="https://www.youtube.com/embed/${video.id}" frameborder="0" allowfullscreen></iframe>
      `;
            list.appendChild(div);
          });
        }

        modal.style.display = "flex";
      }

      //clear history
      function clearHistory() {
        localStorage.removeItem("history");
        showHistory(); // refresh modal
      }

      //closing btn for both popups
      function closeModal(id) {
        document.getElementById(id).style.display = "none";
      }

      function addToFavourites(videoId, title) {
        let favourites = JSON.parse(sessionStorage.getItem("favourites")) || [];
        if (!favourites.find((v) => v.id === videoId)) {
          favourites.push({ id: videoId, title: title });
          sessionStorage.setItem("favourites", JSON.stringify(favourites));
          alert("Added to Favourites!");
        } else {
          alert("Already in favourites!");
        }
      }

      function showFavourites() {
        const modal = document.getElementById("favouritesModal");
        const list = document.getElementById("favouritesList");
        list.innerHTML = "";
        let favourites = JSON.parse(sessionStorage.getItem("favourites")) || [];
        if (favourites.length === 0) {
          list.innerHTML = "<p>No favourites added yet.</p>";
        } else {
          favourites.forEach((video) => {
            const div = document.createElement("div");
            div.innerHTML = `
              <h4>${video.title}</h4>
              <iframe width="100%" height="200" src="https://www.youtube.com/embed/${video.id}" frameborder="0" allowfullscreen></iframe>
            `;
            list.appendChild(div);
          });
        }
        modal.style.display = "flex";
      }

      function clearFavourites() {
        sessionStorage.removeItem("favourites");
        showFavourites();
      }

      fetchVideos(0);
      fetchChannels(category); //showing channels for default category
    </script>
  </body>
</html>
